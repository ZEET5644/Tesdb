<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GitHub Token Manager - Modern Secure Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap');
  body {
    font-family: 'JetBrains Mono', monospace;
    background: linear-gradient(135deg, #0f0f23 0%, #1a1a3a 50%, #2d1b69 100%);
    min-height: 100vh;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem;
    overflow-x: hidden;
    color: white;
    position: relative;
    user-select: none;
  }
  /* Particle background */
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-image:
      radial-gradient(circle at 25% 25%, rgba(138, 43, 226, 0.3) 0%, transparent 50%),
      radial-gradient(circle at 75% 75%, rgba(30, 144, 255, 0.3) 0%, transparent 50%);
    animation: moveParticles 25s linear infinite;
    z-index: -1;
    filter: drop-shadow(0 0 5px rgba(138, 43, 226, 0.4));
  }
  @keyframes moveParticles {
    0% { transform: translate(0, 0); }
    100% { transform: translate(120px, -120px); }
  }
  /* Card style */
  .card {
    background: rgba(255 255 255 / 0.08);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255 255 255 / 0.15);
    border-radius: 1.25rem;
    box-shadow: 0 12px 40px rgba(138, 43, 226, 0.5);
    max-width: 480px;
    width: 100%;
    padding: 2.5rem 2rem;
    animation: fadeInUp 0.8s ease forwards;
    position: relative;
    transition: box-shadow 0.3s ease;
  }
  .card:hover {
    box-shadow: 0 20px 60px rgba(138, 43, 226, 0.8);
  }
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  h1, h2, h3 {
    text-shadow:
      0 0 6px rgba(138, 43, 226, 0.8),
      0 0 12px rgba(138, 43, 226, 0.6);
    user-select: none;
  }
  /* Inputs */
  input, textarea {
    background: rgba(255 255 255 / 0.12);
    border: 1.5px solid rgba(138, 43, 226, 0.5);
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    width: 100%;
    color: white;
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    transition: box-shadow 0.4s ease, border-color 0.4s ease, background 0.4s ease;
    box-shadow: 0 0 0 0 rgba(138, 43, 226, 0);
    caret-color: #8a2be2;
    user-select: text;
  }
  input::placeholder, textarea::placeholder {
    color: rgba(255 255 255 / 0.5);
    font-style: italic;
    letter-spacing: 0.05em;
    user-select: none;
  }
  input:focus, textarea:focus {
    outline: none;
    border-color: #8a2be2;
    box-shadow:
      0 0 8px 3px rgba(138, 43, 226, 0.7),
      inset 0 0 8px 1px rgba(138, 43, 226, 0.5);
    background: rgba(255 255 255 / 0.22);
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }
  /* Buttons */
  .btn-modern {
    background: linear-gradient(45deg, #8a2be2, #1e90ff);
    border: none;
    border-radius: 1rem;
    padding: 0.75rem 2rem;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 8px 30px rgba(138, 43, 226, 0.6);
    color: white;
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.1rem;
    transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    position: relative;
    overflow: hidden;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.6rem;
    user-select: none;
    will-change: transform, box-shadow;
    text-shadow: 0 0 4px rgba(255 255 255, 0.3);
  }
  .btn-modern::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
    transition: left 0.5s;
    z-index: 0;
    border-radius: 1rem;
    filter: drop-shadow(0 0 6px rgba(255 255 255 / 0.3));
  }
  .btn-modern:hover::before {
    left: 100%;
  }
  .btn-modern:hover {
    transform: scale(1.07) translateY(-2px);
    box-shadow: 0 14px 50px rgba(138, 43, 226, 0.8);
    z-index: 1;
  }
  .btn-modern:active {
    transform: scale(0.97);
    box-shadow: 0 6px 20px rgba(138, 43, 226, 0.5);
    transition-duration: 0.1s;
  }
  /* Spinner */
  .spinner {
    border: 3px solid rgba(255,255,255,0.3);
    border-top: 3px solid white;
    border-radius: 50%;
    width: 1.25rem;
    height: 1.25rem;
    animation: spin 1s linear infinite;
    display: inline-block;
    vertical-align: middle;
    filter: drop-shadow(0 0 3px white);
  }
  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
  }
  /* Table */
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 8px;
    margin-top: 1.5rem;
    font-family: 'JetBrains Mono', monospace;
    color: white;
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
    user-select: text;
  }
  th, td {
    padding: 0.75rem 1rem;
    border-bottom: none;
    text-align: left;
    word-break: break-word;
    background: rgba(255 255 255 / 0.05);
    transition: background 0.3s ease, transform 0.3s ease;
    border-radius: 0.75rem;
    box-shadow: inset 0 0 5px rgba(138, 43, 226, 0.15);
  }
  th {
    background: rgba(138, 43, 226, 0.15);
    font-weight: 700;
    text-shadow: 0 0 6px rgba(138, 43, 226, 0.8);
    user-select: none;
  }
  tr:hover td {
    background: rgba(138, 43, 226, 0.25);
    transform: translateX(4px);
    box-shadow: 0 0 15px rgba(138, 43, 226, 0.4);
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }
  /* Action buttons in table */
  .actions button, #token-table button {
    background: #8a2be2;
    border-radius: 0.5rem;
    padding: 0.3rem 0.7rem;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    border: none;
    color: white;
    transition: background 0.3s ease, transform 0.2s ease;
    user-select: none;
    box-shadow: 0 0 8px rgba(138, 43, 226, 0.6);
    filter: drop-shadow(0 0 3px rgba(138, 43, 226, 0.7));
    will-change: transform, background;
  }
  #token-table button:hover {
    background: #5a1abf;
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(90, 26, 191, 0.9);
  }
  #token-table button:active {
    transform: scale(0.95);
    transition-duration: 0.1s;
  }
  .actions button.delete {
    background: #e53e3e;
    box-shadow: 0 0 8px rgba(229, 62, 62, 0.7);
    filter: drop-shadow(0 0 4px rgba(229, 62, 62, 0.8));
  }
  .actions button.delete:hover {
    background: #9b1a1a;
    box-shadow: 0 0 15px rgba(155, 26, 26, 0.9);
  }
  /* Messages */
  .error-msg, .success-msg, .info-msg {
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    margin-top: 1.5rem;
    font-weight: 700;
    text-align: center;
    user-select: none;
    animation: popIn 0.4s ease forwards;
    box-shadow: 0 0 12px rgba(0,0,0,0.3);
    letter-spacing: 0.05em;
  }
  .error-msg {
    background: rgba(255, 0, 0, 0.25);
    color: #ff6b6b;
    text-shadow: 0 0 6px #ff6b6b;
    border: 1.5px solid #ff4c4c;
    filter: drop-shadow(0 0 6px #ff4c4c);
  }
  .success-msg {
    background: rgba(0, 255, 0, 0.25);
    color: #6bff6b;
    text-shadow: 0 0 6px #6bff6b;
    border: 1.5px solid #4caf50;
    filter: drop-shadow(0 0 6px #4caf50);
  }
  .info-msg {
    background: rgba(255, 255, 0, 0.25);
    color: #e6e600;
    text-shadow: 0 0 6px #e6e600;
    border: 1.5px solid #e6e600;
    filter: drop-shadow(0 0 6px #e6e600);
  }
  @keyframes popIn {
    from {opacity: 0; transform: scale(0.8);}
    to {opacity: 1; transform: scale(1);}
  }
  /* Responsive */
  @media (max-width: 520px) {
    .card {
      padding: 2rem 1.5rem;
    }
    .btn-modern {
      width: 100%;
      justify-content: center;
    }
    table {
      font-size: 0.9rem;
    }
  }
  /* Login form tweaks */
  #login-form label {
    display: none; /* hide labels */
  }
  #login-form input {
    font-size: 1.25rem;
    padding: 1rem 1.25rem;
    border-radius: 1rem;
    margin-bottom: 1.5rem;
    text-align: center;
    letter-spacing: 0.1em;
    transition: box-shadow 0.4s ease, border-color 0.4s ease;
    user-select: text;
  }
  #login-form input::placeholder {
    font-style: normal;
    color: rgba(255 255 255 / 0.6);
    font-weight: 600;
    letter-spacing: 0.15em;
    user-select: none;
  }
  #login-btn {
    font-size: 1.3rem;
    padding: 1rem;
    border-radius: 1.5rem;
    font-weight: 900;
    letter-spacing: 0.15em;
    user-select: none;
    box-shadow: 0 8px 30px rgba(138, 43, 226, 0.6);
    transition: box-shadow 0.3s ease, transform 0.3s ease;
  }
  #login-btn:hover {
    box-shadow: 0 14px 50px rgba(138, 43, 226, 0.8);
    transform: scale(1.05);
  }
  #login-btn:active {
    transform: scale(0.95);
    box-shadow: 0 6px 20px rgba(138, 43, 226, 0.5);
    transition-duration: 0.1s;
  }
  #login-error {
    margin-top: 1rem;
    font-size: 1rem;
    font-weight: 700;
    color: #ff4c4c;
    text-shadow: 0 0 8px #ff4c4c;
    user-select: none;
  }
  /* Maintenance banner */
  #maintenance-banner {
    position: fixed;
    top: 0; left: 0; right: 0;
    background: linear-gradient(90deg, #ff4500, #ff6347);
    color: white;
    font-weight: 700;
    text-align: center;
    padding: 0.75rem 1rem;
    font-family: 'JetBrains Mono', monospace;
    z-index: 9999;
    box-shadow: 0 0 15px rgba(255, 69, 0, 0.8);
    display: none;
    user-select: none;
    animation: bannerPulse 2.5s ease-in-out infinite;
    letter-spacing: 0.05em;
  }
  @keyframes bannerPulse {
    0%, 100% { box-shadow: 0 0 15px rgba(255, 69, 0, 0.8); }
    50% { box-shadow: 0 0 30px rgba(255, 69, 0, 1); }
  }
  /* Maintenance toggle */
  #maintenance-toggle-container {
    margin-bottom: 1.5rem;
    text-align: center;
    user-select: none;
  }
  #maintenance-toggle {
    cursor: pointer;
    width: 50px;
    height: 25px;
    background: #555;
    border-radius: 25px;
    position: relative;
    display: inline-block;
    vertical-align: middle;
    transition: background 0.3s ease;
    box-shadow: inset 0 0 6px rgba(0,0,0,0.5);
    will-change: background;
  }
  #maintenance-toggle::before {
    content: '';
    position: absolute;
    top: 2px; left: 2px;
    width: 21px; height: 21px;
    background: white;
    border-radius: 50%;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    will-change: transform;
  }
  #maintenance-toggle.active {
    background: #8a2be2;
  }
  #maintenance-toggle.active::before {
    transform: translateX(25px);
  }
  #maintenance-label {
    margin-left: 0.75rem;
    font-weight: 700;
    font-size: 1rem;
    user-select: none;
    color: #ddd;
  }
  </style>
</head>
<body>
  <div id="maintenance-banner" role="alert" aria-live="assertive">⚠️ Website is currently under maintenance. Some features are disabled.</div>

  <!-- Login Section -->
  <section id="login-section" class="card" aria-label="Login Section">
    <h1 class="text-4xl font-bold mb-8 text-center glow">Secure Login Portal</h1>
    <form id="login-form" autocomplete="off" novalidate>
      <label for="username">Username</label>
      <input type="text" id="username" name="username" placeholder="Username" required autocomplete="username" />
      <label for="password">Password</label>
      <input type="password" id="password" name="password" placeholder="Password" required autocomplete="current-password" />
      <button type="submit" id="login-btn" class="btn-modern relative w-full">
        <span>Login</span>
        <span id="login-spinner" class="spinner" style="display:none; position:absolute; right:1rem; top:50%; transform: translateY(-50%);"></span>
      </button>
    </form>
    <div id="login-error" class="error-msg" style="display:none;">Invalid username or password.</div>
  </section>

<!-- Token Management Section -->
<section id="token-section" class="card hidden max-w-3xl mx-auto" aria-label="Token Management Section">
  <h2 class="text-3xl font-bold mb-8 text-center glow">Token Management Hub</h2>

  <!-- Maintenance toggle only for Admin -->
  <div id="maintenance-toggle-container" class="hidden">
    <span id="maintenance-label">Maintenance Mode:</span>
    <div id="maintenance-toggle" role="switch" aria-checked="false" tabindex="0" aria-label="Toggle maintenance mode"></div>
  </div>

  <div class="flex justify-center gap-4 mb-8 flex-wrap">
    <!-- Tombol untuk Admin dan Reseller -->
    <button id="btn-add-token" class="btn-modern px-6 py-2" title="Add a new GitHub token">Add Token</button>

    <button id="btn-load-github" class="btn-modern px-6 py-2" title="Load tokens from GitHub repo">Load Tokens from GitHub</button>

    <button id="btn-view-tokens" class="btn-modern px-6 py-2 hidden" title="View saved tokens">View Tokens</button>

    <!-- Tombol Delete All Tokens hanya untuk Admin -->
    <button id="btn-delete-all-tokens" class="btn-modern px-6 py-2 bg-red-600 hover:bg-red-700 hidden" title="Delete all tokens">Delete All Tokens</button>

    <button id="btn-logout" class="btn-modern px-6 py-2 bg-red-600 hover:bg-red-700" title="Logout">Logout</button>
  </div>

  <!-- Add Token Form -->
  <div id="add-token-form" class="hidden max-w-xl mx-auto">
    <form id="form-add-token" autocomplete="off" novalidate>
      <label for="input-token" class="block mb-2 font-semibold">GitHub Token</label>
      <input type="password" id="input-token" placeholder="Enter GitHub token" required autocomplete="off" />
      <button type="submit" class="btn-modern mt-6 w-full relative">
        <span>Create</span>
        <span id="add-spinner" class="spinner" style="display:none; position:absolute; right:1rem; top:50%; transform: translateY(-50%);"></span>
      </button>
    </form>
    <div id="add-success" class="success-msg" style="display:none;">Token added successfully!</div>
    <div id="add-error" class="error-msg" style="display:none;"></div>
  </div>

  <!-- Token List -->
  <div id="token-list-section" class="hidden max-w-3xl mx-auto">
    <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
      <input type="text" id="search-token" placeholder="🔍 Search token..." class="px-3 py-2 rounded-lg bg-white/10 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-purple-500 flex-1" />
      <span id="token-counter" class="font-semibold text-green-400">Total Tokens: 0</span>
    </div>
    <table id="token-table" aria-label="Token list" role="grid" tabindex="0">
      <!-- Isi tabel akan di-render oleh JS -->
    </table>
    <div class="flex justify-center gap-4 mt-8 flex-wrap">
      <button id="btn-export" class="btn-modern px-6 py-2" title="Export tokens as JSON">Export Tokens</button>
      <!-- Tombol Delete All Tokens hanya untuk Admin -->
      <button id="btn-delete-all-tokens" class="btn-modern px-6 py-2 bg-red-600 hover:bg-red-700 hidden" title="Delete all tokens">Delete All Tokens</button>
    </div>
    <div id="list-error" class="error-msg" style="display:none; margin-top:1.5rem;"></div>
    <div id="list-success" class="success-msg" style="display:none; margin-top:1.5rem;"></div>
  </div>
</section>
</body>
</html>

<script>
(() => {
  const GITHUB_REPO = "ZEET5644/DbDreados";
  const FILE_PATH = "bokep.json";
  const GITHUB_TOKEN = "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";

  // DOM Elements
  const loginSection = document.getElementById('login-section');
  const tokenSection = document.getElementById('token-section');
  const loginForm = document.getElementById('login-form');
  const loginBtn = document.getElementById('login-btn');
  const loginSpinner = document.getElementById('login-spinner');
  const loginError = document.getElementById('login-error');

  const btnAddToken = document.getElementById('btn-add-token');
  const btnViewTokens = document.getElementById('btn-view-tokens');
  const btnLoadGithub = document.getElementById('btn-load-github');
  const btnLogout = document.getElementById('btn-logout');

  const btnDeleteAllTokens = document.getElementById('btn-delete-all-tokens');

  const addTokenFormContainer = document.getElementById('add-token-form');
  const formAddToken = document.getElementById('form-add-token');
  const inputToken = document.getElementById('input-token');
  const addSpinner = document.getElementById('add-spinner');
  const addSuccess = document.getElementById('add-success');
  const addError = document.getElementById('add-error');

  const tokenListSection = document.getElementById('token-list-section');
  const tokenTable = document.getElementById('token-table');
  const btnExport = document.getElementById('btn-export');
  const listError = document.getElementById('list-error');
  const listSuccess = document.getElementById('list-success');
  const searchInput = document.getElementById('search-token');
  const tokenCounter = document.getElementById('token-counter');

  const maintenanceBanner = document.getElementById('maintenance-banner');
  const maintenanceToggleContainer = document.getElementById('maintenance-toggle-container');
  const maintenanceToggle = document.getElementById('maintenance-toggle');

  // State
  let tokens = [];
  let currentUser  = null; // 'Admin' or 'Reseller'
  let maintenanceMode = false;

  // Load maintenance mode from localStorage
  function loadMaintenanceMode() {
    const saved = localStorage.getItem('maintenanceMode');
    maintenanceMode = saved === 'true';
    updateMaintenanceToggleUI();
  }
  // Save maintenance mode to localStorage
  function saveMaintenanceMode() {
    localStorage.setItem('maintenanceMode', maintenanceMode ? 'true' : 'false');
  }
  // Update maintenance toggle UI
  function updateMaintenanceToggleUI() {
    if (maintenanceMode) {
      maintenanceToggle.classList.add('active');
      maintenanceToggle.setAttribute('aria-checked', 'true');
      maintenanceBanner.style.display = 'block';
    } else {
      maintenanceToggle.classList.remove('active');
      maintenanceToggle.setAttribute('aria-checked', 'false');
      maintenanceBanner.style.display = 'none';
    }
  }

  // --- Login ---
  loginForm.addEventListener('submit', async e => {
    e.preventDefault();
    loginError.style.display = 'none';

    const username = loginForm.username.value.trim();
    const password = loginForm.password.value.trim();

    if ((username === 'Admin' && password === 'Killertzy') || (username === 'Reseller' && password === 'Killertzy')) {
      currentUser  = username;
      loginBtn.disabled = true;
      loginSpinner.style.display = 'inline-block';

      try {
        await new Promise(resolve => setTimeout(resolve, 1000));

        loginSection.classList.add('hidden');
        tokenSection.classList.remove('hidden');

        if (currentUser  === 'Admin') {
          maintenanceToggleContainer.classList.remove('hidden');
          btnDeleteAllTokens.style.display = 'inline-flex';
        } else {
          maintenanceToggleContainer.classList.add('hidden');
          btnDeleteAllTokens.style.display = 'none';
        }

        loadMaintenanceMode();
        applyAccessControl();
        showTokenListSection();

      } catch (err) {
        loginError.textContent = "Terjadi error saat login.";
        loginError.style.display = 'block';
      } finally {
        loginBtn.disabled = false;
        loginSpinner.style.display = 'none';
      }
    } else {
      loginError.style.display = 'block';
    }
  });

  // --- Maintenance toggle ---
  maintenanceToggle.addEventListener('click', () => {
    if (currentUser  !== 'Admin') return;
    maintenanceMode = !maintenanceMode;
    saveMaintenanceMode();
    updateMaintenanceToggleUI();
    applyAccessControl();
  });
  maintenanceToggle.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      maintenanceToggle.click();
    }
  });

  // --- Access control ---
  function applyAccessControl() {
    if (currentUser  === 'Admin') {
      btnAddToken.disabled = false;
      btnLoadGithub.disabled = false;
      btnDeleteAllTokens.style.display = 'inline-flex';
      addTokenFormContainer.querySelector('input').disabled = false;
      formAddToken.querySelector('button[type="submit"]').disabled = false;
      searchInput.disabled = false;
      tokenListSection.querySelectorAll('button.delete').forEach(b => b.disabled = false);

      maintenanceBanner.style.display = maintenanceMode ? 'block' : 'none';
      listError.style.display = 'none';
      listSuccess.style.display = 'none';

      tokenListSection.classList.remove('hidden');
      addTokenFormContainer.classList.add('hidden');
    } else if (currentUser  === 'Reseller') {
      btnDeleteAllTokens.style.display = 'none';

      if (maintenanceMode) {
        btnAddToken.disabled = true;
        btnLoadGithub.disabled = true;
        addTokenFormContainer.classList.add('hidden');
        tokenListSection.classList.remove('hidden');
        inputToken.disabled = true;
        formAddToken.querySelector('button[type="submit"]').disabled = true;
        searchInput.disabled = true;
        tokenListSection.querySelectorAll('button.delete').forEach(b => b.disabled = true);
        maintenanceBanner.style.display = 'block';
        listError.textContent = "⚠️ Website is under maintenance. Token management is disabled for Reseller.";
        listError.style.display = 'block';
        listSuccess.style.display = 'none';
      } else {
        btnAddToken.disabled = false;
        btnLoadGithub.disabled = false;
        addTokenFormContainer.querySelector('input').disabled = false;
        formAddToken.querySelector('button[type="submit"]').disabled = false;
        searchInput.disabled = false;
        tokenListSection.querySelectorAll('button.delete').forEach(b => b.disabled = false);
        maintenanceBanner.style.display = 'none';
        listError.style.display = 'none';
        listSuccess.style.display = 'none';
      }

      tokenListSection.classList.remove('hidden');
      addTokenFormContainer.classList.add('hidden');
    }
  }

  // --- Clear messages ---
  function clearMessages() {
    addError.style.display = 'none';
    addSuccess.style.display = 'none';
    listError.style.display = 'none';
    listSuccess.style.display = 'none';
  }

  // --- Show forms ---
  function showAddTokenForm() {
    clearMessages();
    if (currentUser  === 'Reseller' && maintenanceMode) {
      listError.textContent = "⚠️ Cannot add tokens while website is under maintenance.";
      listError.style.display = 'block';
      return;
    }
    addTokenFormContainer.classList.remove('hidden');
    tokenListSection.classList.add('hidden');
    inputToken.value = '';
    inputToken.focus();
  }
  function showTokenListSection() {
    clearMessages();
    addTokenFormContainer.classList.add('hidden');
    tokenListSection.classList.remove('hidden');
    renderTokenTable();
  }

  // --- GitHub API Helpers ---
  async function getGithubFileData(path) {
    const url = `https://api.github.com/repos/${GITHUB_REPO}/contents/${path}`;
    const res = await fetch(url, { headers: { Authorization: `token ${GITHUB_TOKEN}` } });
    if (!res.ok) throw new Error(`GitHub API error: ${res.status} ${res.statusText}`);
    return await res.json();
  }
  async function updateGithubFile(path, contentObj, sha, message) {
    const url = `https://api.github.com/repos/${GITHUB_REPO}/contents/${path}`;
    const base64Content = btoa(JSON.stringify(contentObj, null, 2));
    const body = { message, content: base64Content, sha, branch: "main" };
    const res = await fetch(url, {
      method: "PUT",
      headers: { Authorization: `token ${GITHUB_TOKEN}`, "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    if (!res.ok) throw new Error(`GitHub API error: ${res.status} ${res.statusText}`);
    return await res.json();
  }

  // --- Load tokens ---
  async function loadTokens() {
    try {
      const fileData = await getGithubFileData(FILE_PATH);
      if (!fileData.content) {
        tokens = [];
        return;
      }
      const decoded = atob(fileData.content.replace(/\n/g, ""));
      const json = JSON.parse(decoded);
      tokens = Array.isArray(json.tokens) ? json.tokens.map(t => ({ token: t, createdAt: new Date().toISOString() })) : [];
    } catch {
      tokens = [];
    }
  }
  // --- Save tokens ---
  async function saveTokens(message = "Update tokens") {
    try {
      const fileData = await getGithubFileData(FILE_PATH);
      const sha = fileData.sha;
      const exportArray = tokens.map(t => t.token);
      await updateGithubFile(FILE_PATH, { tokens: exportArray }, sha, message);
      console.log("✅ Tokens updated to GitHub.");
    } catch (err) {
      console.error("❌ Failed to save tokens to GitHub:", err.message);
    }
  }

  // --- Render token table ---
  // Fungsi masking adaptive
function maskToken(str, maskLength = 6) {
  if (!str) return '';

  const len = str.length;

  if (len <= 8) {
    // Token pendek: tampilkan 1-2 karakter depan dan belakang, sensor sisanya
    const visible = Math.max(1, Math.floor(len / 4)); // minimal 1 karakter
    const start = str.slice(0, visible);
    const end = str.slice(len - visible);
    const maskedMiddle = '*'.repeat(len - 2 * visible);
    return start + maskedMiddle + end;
  }

  // Token panjang: sensor maskLength karakter tengah
  const startLength = Math.floor((len - maskLength) / 2);
  const endLength = len - startLength - maskLength;

  const start = str.slice(0, startLength);
  const end = str.slice(len - endLength);
  const maskedMiddle = '*'.repeat(maskLength);

  return start + maskedMiddle + end;
}

// Fungsi render token table
function renderTokenTable() {
  const searchTerm = searchInput.value.trim().toLowerCase();
  const filteredTokens = tokens.filter(t => t.token.toLowerCase().includes(searchTerm));
  tokenCounter.textContent = `Total Tokens: ${filteredTokens.length}`;
  if (filteredTokens.length === 0) {
    tokenTable.innerHTML = `<tr><td colspan="3" class="text-center p-4">No tokens found.</td></tr>`;
    return;
  }
  let html = `
    <thead>
      <tr>
        <th>Token</th>
        <th>Created At</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
  `;
  filteredTokens.forEach((tokenObj, index) => {
    const masked = maskToken(tokenObj.token, 6); // sensor 6 karakter tengah
    const createdAt = new Date(tokenObj.createdAt).toLocaleString();
    html += `
      <tr>
        <td>${masked}</td>
        <td>${createdAt}</td>
        <td>
          ${currentUser  === 'Admin' ? `<button class="view-token" data-index="${index}">👁 View</button>` : ''}
          <button class="delete" data-index="${index}">🗑 Delete</button>
        </td>
      </tr>
    `;
  });
  html += "</tbody>";
  tokenTable.innerHTML = html;

  // Event Delete
  tokenTable.querySelectorAll('button.delete').forEach(btn => {
    btn.addEventListener('click', async e => {
      const idx = parseInt(e.target.dataset.index, 10);
      if (confirm("Are you sure you want to delete this token?")) {
        tokens.splice(idx, 1);
        await saveTokens("Delete a token");
        renderTokenTable();
        listSuccess.textContent = "Token deleted successfully.";
        listSuccess.style.display = "block";
        setTimeout(() => listSuccess.style.display = "none", 3000);
      }
    });
  });

  // Event View (Admin only)
  if (currentUser  === 'Admin') {
    tokenTable.querySelectorAll('button.view-token').forEach(btn => {
      btn.addEventListener('click', e => {
        const idx = parseInt(e.target.dataset.index, 10);
        alert(`Full Token: ${tokens[idx].token}`);
      });
    });
  }

  // Disable delete untuk reseller saat maintenance
  if (currentUser  === 'Reseller' && maintenanceMode) {
    tokenTable.querySelectorAll('button.delete').forEach(b => b.disabled = true);
  }
}

searchInput.addEventListener('input', renderTokenTable);

  // --- Button event handlers ---
  btnAddToken.addEventListener('click', () => {
    showAddTokenForm();
  });

  btnViewTokens.addEventListener('click', () => {
    showTokenListSection();
  });

  btnLoadGithub.addEventListener('click', async () => {
    clearMessages();
    btnLoadGithub.disabled = true;
    btnLoadGithub.textContent = "Loading...";
    try {
      await loadTokens();
      renderTokenTable();
      listSuccess.textContent = "Tokens loaded from GitHub successfully.";
      listSuccess.style.display = "block";
      btnViewTokens.classList.remove('hidden'); // Tampilkan tombol View Tokens
    } catch (err) {
      listError.textContent = "Failed to load tokens from GitHub.";
      listError.style.display = "block";
    } finally {
      btnLoadGithub.disabled = false;
      btnLoadGithub.textContent = "Load Tokens from GitHub";
    }
  });

  btnLogout.addEventListener('click', () => {
    if (confirm("Are you sure you want to logout?")) {
      currentUser  = null;
      tokens = [];
      loginSection.classList.remove('hidden');
      tokenSection.classList.add('hidden');
      maintenanceToggleContainer.classList.add('hidden');
      clearMessages();
      loginForm.reset();
      btnViewTokens.classList.add('hidden');
    }
  });

  btnDeleteAllTokens.addEventListener('click', async () => {
    if (currentUser  !== 'Admin') return;
    if (confirm("Are you sure you want to delete ALL tokens? This action cannot be undone.")) {
      tokens = [];
      await saveTokens("Delete all tokens");
      renderTokenTable();
      listSuccess.textContent = "All tokens deleted successfully.";
      listSuccess.style.display = "block";
      setTimeout(() => listSuccess.style.display = "none", 3000);
    }
  });

  // --- Add token form submit ---
  formAddToken.addEventListener('submit', async e => {
    e.preventDefault();
    clearMessages();

    if (currentUser  === 'Reseller' && maintenanceMode) {
      listError.textContent = "⚠️ Cannot add tokens while website is under maintenance.";
      listError.style.display = 'block';
      return;
    }

    const newToken = inputToken.value.trim();
    if (!newToken) {
      addError.textContent = "Token cannot be empty.";
      addError.style.display = 'block';
      return;
    }
    if (tokens.some(t => t.token === newToken)) {
      addError.textContent = "Token already exists.";
      addError.style.display = 'block';
      return;
    }

    addSpinner.style.display = 'inline-block';
    formAddToken.querySelector('button[type="submit"]').disabled = true;

    try {
      tokens.push({ token: newToken, createdAt: new Date().toISOString() });
      await saveTokens("Add new token");
      addSuccess.style.display = 'block';
      inputToken.value = '';
      renderTokenTable();
    } catch (err) {
      addError.textContent = "Failed to add token.";
      addError.style.display = 'block';
    } finally {
      addSpinner.style.display = 'none';
      formAddToken.querySelector('button[type="submit"]').disabled = false;
    }
  });
  
   // Tambahkan animasi fadeIn dan fadeOut untuk transisi antar tampilan
  function fadeIn(element) {
    element.style.opacity = 0;
    element.style.display = 'block';
    let last = +new Date();
    const tick = () => {
      element.style.opacity = +element.style.opacity + (new Date() - last) / 200;
      last = +
            new Date();
      if (+element.style.opacity < 1) {
        requestAnimationFrame(tick);
      }
    };
    tick();
  }
  function fadeOut(element) {
    element.style.opacity = 1;
    let last = +new Date();
    const tick = () => {
      element.style.opacity = +element.style.opacity - (new Date() - last) / 200;
      last = +new Date();
      if (+element.style.opacity > 0) {
        requestAnimationFrame(tick);
      } else {
        element.style.display = 'none';
      }
    };
    tick();
  }

  // Override showAddTokenForm dan showTokenListSection dengan animasi
  function showAddTokenForm() {
    clearMessages();
    if (currentUser  === 'Reseller' && maintenanceMode) {
      listError.textContent = "⚠️ Cannot add tokens while website is under maintenance.";
      listError.style.display = 'block';
      return;
    }
    fadeOut(tokenListSection);
    setTimeout(() => {
      addTokenFormContainer.style.display = 'block';
      addTokenFormContainer.style.opacity = 0;
      fadeIn(addTokenFormContainer);
      inputToken.value = '';
      inputToken.focus();
    }, 250);
  }
  function showTokenListSection() {
    clearMessages();
    fadeOut(addTokenFormContainer);
    setTimeout(() => {
      tokenListSection.style.display = 'block';
      tokenListSection.style.opacity = 0;
      fadeIn(tokenListSection);
      renderTokenTable();
    }, 250);
  }

  // Update maintenance toggle UI dengan ARIA dan keyboard support
  maintenanceToggle.setAttribute('role', 'switch');
  maintenanceToggle.setAttribute('tabindex', '0');
  maintenanceToggle.setAttribute('aria-checked', 'false');

  maintenanceToggle.addEventListener('click', () => {
    if (currentUser  !== 'Admin') return;
    maintenanceMode = !maintenanceMode;
    saveMaintenanceMode();
    updateMaintenanceToggleUI();
    applyAccessControl();
  });
  maintenanceToggle.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      maintenanceToggle.click();
    }
  });

  // Inisialisasi awal
  (async () => {
    tokenSection.classList.add('hidden');
    loginSection.classList.remove('hidden');
    loadMaintenanceMode();
  })();

  // Sisanya tetap sama seperti kode Anda sebelumnya, termasuk event listener, renderTokenTable, dll.

  // Initial setup
  (async () => {
    tokenSection.classList.add('hidden');
    loginSection.classList.remove('hidden');
  })();

})();
</script>
</body>
</html>